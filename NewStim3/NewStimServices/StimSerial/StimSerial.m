function out=stimserial(cmd,varargin)% StimSerial - Interface to serial ports for NewStim.%%  See 'help StimSerialGlobals' for a description of the interface.%%   on MAC2 it is a wrapper for PsychSerial provided by the Psychophysics%   toolbox%   on other systems it is a wrapper around the matlab SERIAL function%% 2007, Alexander Heimel%if strcmp(computer,'MAC2')    arglist=[];    for i=1:length(varargin)        arglist=[arglist ',varargin{' num2str(i) '}'];    end	    command  = ['PsychSerial(cmd' arglist ');'];	switch lower(cmd)		case {'dtr','rts'}		    if length(varargin)>1 % probably setting value, no output				out = [];			else				command = ['out=' command];			end		otherwise			command = ['out=' command];	end	eval(command);else    cmd=lower(cmd);    if strcmp(cmd,'open')        out=serial(varargin{1});        fopen(out);    elseif strcmp(cmd,'close')        fclose(varargin{1});    elseif strcmp(cmd,'dtr')        state=num2state(varargin{2});        set(varargin{1},'DataTerminalReady',state);    elseif strcmp(cmd,'rts')        state=num2state(varargin{2});        set(varargin{1},'RequestToSend',state);    else        warning('stimserial:unkncmd','stimserial, Unknown command ''%s''.',cmd);    endendfunction state=num2state( num)% changes 0,1 to 'on','off'  if isempty(num)      state='on';  elseif ~isnumeric(num)      state=num; % assume it is allright already  else      if num==1          state='on';      else          state='off';      end  end  